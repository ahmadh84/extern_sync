Thanks to Xiaodi Hou for this set of functions.

